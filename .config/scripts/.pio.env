export PATH=$PATH:/home/$USER/.platformio/penv/bin

SSH_DEST_ADDR="etienne@192.168.1.105"  #TODO customize with own configuration
PIO_DOWNLOAD_URL="https://raw.githubusercontent.com/platformio/platformio-core-installer/master/get-platformio.py"
PIO_BUILD_ENV="esp32-latest"
PIO_CONFIG_PATH="lib/esp32-toolkit-lib/.config/platformio.ini"
GIT_MODULES_PATH="lib/esp32-toolkit-lib/.config/.gitmodules"
FIRMWARE_SRC="lib/esp32-toolkit-lib/examples/firmware-main.cpp"
FIRMWARE_BIN=".pio/build/$PIO_BUILD_ENV/firmware.bin"
FS_IMG=".pio/build/$PIO_BUILD_ENV/spiffs.bin"
ESP_UPLOAD_CMD="esptool.py --chip esp32 --port "/dev/ttyUSB0" --baud 460800 --before default_reset --after hard_reset write_flash -z --flash_mode dio --flash_freq 40m --flash_size 4MB"
CURRENT_PROJECT_DIR="/var/lib/docker/volumes/projects-data/_data//esp/esp32-pio-workspace/"
PIO_INSTALL_DIR="/var/lib/docker/volumes/projects-home/_data/.platformio/"
PIO_BUILD_DIR=CURRENT_PROJECT_DIR".pio/build/esp32-latest/"
FIRMWARE_FILE_PATH=$PIO_BUILD_DIR"firmware.bin"
BOOTLOADER_FILE_PATH=$PIO_BUILD_DIR"bootloader.bin"
PARTITIONS_FILE_PATH=$PIO_BUILD_DIR"partitions.bin"
FS_IMAGE_FILE_PATH=$PIO_BUILD_DIR"littlefs.bin"
BOOT_FILE_PATH=$PIO_INSTALL_DIR"packages/framework-arduinoespressif32/tools/partitions/boot_app0.bin"


alias pio-install='curl -fsSL $PIO_DOWNLOAD_URL -o get-platformio.py && python3 get-platformio.py '
alias pio-install-rules='curl -fsSL https://raw.githubusercontent.com/platformio/platformio-core/develop/platformio/assets/system/99-platformio-udev.rules | sudo tee /etc/udev/rules.d/99-platformio-udev.rules'
alias pio-init-workspace='ln -s $PIO_CONFIG_PATH platformio.ini &&\
    ln -s $GIT_MODULES_PATH  .gitmodules &&\
    mkdir src && ln -s ../$FIRMWARE_SRC src/main.cpp'
alias pio-build-firmware='pio run -e esp32-latest'
alias pio-build-fs='pio run -e esp32-latest -t '
alias pio-upload-firmware='pio run -e esp32-latest -t upload'
alias pio-upload-fs='pio run -e esp32-latest -t uploadfs'
alias pio-send-bin='scp $FIRMWARE_BIN $SSH_DEST_ADDR:~/'
alias pio-send-img='scp $FS_IMG $SSH_DEST_ADDR:~/'
alias esp-upload-firmware='ESP_UPLOAD_CMD 0x10000 firmware.bin'
alias esp-upload-fs='$ESP_UPLOAD_CMD 2686976 FS_IMAGE_FILE_PATH'
alias esp-upload-all='ESP_UPLOAD_CMD 0x1000 BOOTLOADER_FILE_PATH 0x8000 PARTITIONS_FILE_PATH 0xe000 BOOT_FILE_PATH 0x10000 FIRMWARE_FILE_PATH'
